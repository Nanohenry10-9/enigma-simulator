<!DOCTYPE html>
<html onclick="ee(event)">
	<head>
		<title>The Enigma Machine</title>
		<link rel="icon" type="image/png" href="favicon.png">
		<link rel="stylesheet" href="./style.css">
		<link rel="icon" href="./favicon.ico">
		<script src="processing.js"></script>
	</head>
	<body>
		<h1 id="title"><b>The Enigma Machine</b></h1>
		<canvas data-processing-sources="./enigma/enigma.pde" id="simulator"></canvas>
		<img src="info.png" id="infoBtn" onclick="help()">
		<div id="op">
			<input type="text" onkeyup="check()" id="text-in"><br>
			<input type="button" value="Crypt!" id="button" onclick="crypt()"><br>
			<input type="text" id="text-out"><br>
			<input type="button" value="Reset" id="reset" onclick="reset()">
		</div>
		<script>
			setInterval(readCipher, 20);
			var _reset = 0;
			var _plaintext = "", _ciphertext = "";
			var int;
			function check() {
				document.getElementById("text-in").value = document.getElementById("text-in").value.toUpperCase();
			}
			function crypt() {
				var text = document.getElementById("text-in").value;
				if (text == "THE ENIGMA MACHINE") {
					int = setInterval(scramble, 150);
					setTimeout(stopScramble, 1500);
				}
				_plaintext = text;
			}
			function reset() {
				_reset = 1;
			}
			function readCipher() {
				document.getElementById("text-out").value = _ciphertext;
			}
			function ee(e) {
				if (e.x == 0 && e.y == 0) {
					window.location.href = "https://buster.lu";
				}
			}
			function help() {
				alert("Input: keyboard keys A - Z\nChange plugboard: CTRL + [key 1, A - Z] + [key 2, A - Z]\nChange rotors: CTRL + [rotor number, 1 - 3] + [rotor name, 1 - 3]\nReset rotors: CTRL + SPACE\n\n(you may need to first click on the simulator to use it)");
			}
			function scramble() {
				var t = document.getElementById("title");
				var chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
				for (var i = 0; i < t.innerHTML.length; i++) {
					if (t.innerHTML[i] != ' ') {
					    t.innerHTML[i] = chars.charAt(Math.floor(Math.random() * chars.length));
					}
				}
			}
			function stopScramble() {
				clearInterval(int);
				document.getElementById("title").innerHTML = "Opc Wclznl Vkkgqon";
			}
		</script>
	</body>
</html>
