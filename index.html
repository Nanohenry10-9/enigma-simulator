<!DOCTYPE html>
<html onclick="ee(event)">
	<head>
		<title>The Enigma Machine</title>
		<link rel="icon" type="image/png" href="favicon.png">
		<link rel="stylesheet" href="./style.css">
		<link rel="icon" href="./favicon.ico">
		<script src="processing.js"></script>
	</head>
	<body>
		<h1 id="title">The Enigma Machine</h1>
		<canvas data-processing-sources="./enigma/enigma.pde" id="simulator"></canvas>
		<img src="info.png" id="infoBtn" onclick="help()">
		<div id="op">
			<input type="text" onkeyup="check()" id="text-in"><br>
			<input type="button" value="Crypt!" id="button" onclick="crypt()"><br>
			<input type="text" id="text-out"><br>
			<input type="button" value="Reset" id="reset" onclick="reset()">
		</div>
		<div id="popup" class="init-hidden">
			<h4 class="popupText" id="popupTextHeader">The Enigma Machine</h4>
			<a id="exitBtn" onclick="closeHelp()">X</a>
			<p class="popupText" id="popupTextContent">
			The Enigma Machine simulator controls:<br><br>
			<b>Input:</b> keyboard keys A - Z<br><br>
			<b>Change plugboard:</b> CTRL + [key 1, A - Z] + [key 2, A - Z]<br><br>
			<b>Change rotors:</b> CTRL + [rotor number, 1 - 3] + [rotor name, 1 - 3]<br><br>
			<b>Reset rotors:</b> CTRL + SPACE<br><br>
			Note that in some browsers you will first need to click on the simulator to use it.</p>
		</div>
		<script>
			setInterval(readCipher, 20);
			var _reset = 0;
			var _plaintext = "", _ciphertext = "";
			var int;
			var jhdjhja = " ";
			var asdfasdf = "AMGI";
			var ehguaid = "ENIHCAM";
			var hbsfioajhdf = String.fromCharCode(84) + "HE" + jhdjhja + ehguaid.charAt(0) + ehguaid.charAt(1) + asdfasdf.split("").reverse().join("") + jhdjhja + ehguaid.split("").reverse().join("");
			var helpShown = false;
			function check() {
				document.getElementById("text-in").value = document.getElementById("text-in").value.toUpperCase();
			}
			function crypt() {
				var text = document.getElementById("text-in").value;
				if (text == hbsfioajhdf) {
					int = setInterval(scramble, 30);
					setTimeout(stopScramble, 1500);
				}
				_plaintext = text;
			}
			function reset() {
				_reset = 1;
			}
			function readCipher() {
				document.getElementById("text-out").value = _ciphertext;
			}
			function ee(e) {
				if (e.x == 0 && e.y == 0) {
					window.location.href = "https://buster.lu";
				}
			}
			function help() {
				document.getElementById("popup").classList.remove("init-hidden");
				document.getElementById("popup").classList.remove("box-hidden");
				document.getElementById("popup").classList.add("box-shown");
				helpShown = true;
			}
			function closeHelp() {
				document.getElementById("popup").classList.remove("box-shown");
				document.getElementById("popup").classList.add("box-hidden");
				helpShown = false;
			}
			function scramble() {
				var t = document.getElementById("title");
				var chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
				for (var i = 0; i < t.innerHTML.length; i++) {
					if (chars.includes(t.innerHTML.charAt(i))) {
					    t.innerHTML = t.innerHTML.replaceAt(i, chars.charAt(Math.floor(Math.random() * chars.length)));
					}
				}
			}
			function stopScramble() {
				clearInterval(int);
				document.getElementById("title").innerHTML = "Opc Wclznl Vkkgqon";
			}
			String.prototype.replaceAt = function(index, replacement) {
				return this.substr(0, index) + replacement + this.substr(index + replacement.length);
			}
			document.getElementById("title").innerHTML = "The Enigma Machine";
		</script>
	</body>
</html>
